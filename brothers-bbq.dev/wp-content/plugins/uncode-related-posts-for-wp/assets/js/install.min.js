jQuery(document).ready(function($){function t(t){this.step=t,this.total_posts=0,this.ppr=null,this.action=null,this.percentage_object=null,this.nonce=null;var s=!1;this.do_request=function(){var t=this;$.post(ajaxurl,{action:this.action,nonce:$("#rp4wp-ajax-nonce").val(),ppr:this.ppr,rel_amount:$("#rp4wp_related_posts_amount").val()},function(r){var e=new RegExp("^[0-9]+$");if(r=r.trim(),""===r&&(r="0"),e.test(r)){var o=parseInt(r);if(t.do_progressbar(o),s==o)return void t.done();o>0||s==o?t.do_request():t.done(),s=o}else alert("Woops! Something went wrong while linking.\n\nResponse:\n\n"+r)})},this.done=function(){$("#progressbar").progressbar({value:100}),window.location=$("#rp4wp_admin_url").val()+"?page=rp4wp_install&rp4wp_nonce="+this.nonce+"&step="+(this.step+1)},this.do_progressbar=function(t){var s=this.total_posts-t;0>s&&(s=0),jQuery("#progress-done").html(s),jQuery("#progress-todo").html(t);var r=Math.round(s/this.total_posts*100);r>0&&(this.percentage_object.html(r+"%"),$("#progressbar").progressbar({value:r}))},this.init=function(){switch($("#progressbar").progressbar({value:!1}),this.percentage_object=jQuery("<span>"),$("#progressbar").find("div:first").append(this.percentage_object),this.do_progressbar($("#rp4wp_posts_todo").val()),this.total_posts=$("#rp4wp_total_posts").val(),this.nonce=$("#rp4wp_nonce").val(),this.step){case 1:this.ppr=25,this.action="rp4wp_install_save_words";break;case 2:this.ppr=5,this.action="rp4wp_install_link_posts"}jQuery("#progress-container").show(),this.do_request()},this.init()}var s=$(".rp4wp-step").attr("rel");1==s?t(1):2==s&&$("#rp4wp-link-now").click(function(){t(2)})});